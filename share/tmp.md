좋았던 점

- 수료때문에 리뷰가 몰렸을텐데도 자세하게 해주셨던 것
- 지금 사용하지 않아도 나중에 고민해야 되는 부분들을 짚어주셨던 것
    - 로그의 사용
    - 동기화 관련 (특히 리퀘스트 안에서 어떻게 상태를 다루면 좋을지에 대해 생각해볼 수 있게 해주신 것)
    - 콜백 개념 (템플릿을 사용한 것에서 더 나아갈 수 있도록)
- 구조에 대해 좀 더 고민할 수 있도록
    - 서비스에 대해서도.. 좀 더 여러 서비스로 나눌 수 있는 여지가 있는 것들인지 고민해볼 수 있도록 하신 것
- 피드백을 주실 때 '왜' 이 피드백을 주신건지 명시해 주신 것
    - 덕분에 '왜' 이런 것들을 고민해야 하는 구나를 다시 생각하게 됩니다 :)

아쉬웠던 점

- 수료까지 얼마 남지 않아서.. 피드백을 더 주고 받지 못한게 아쉽네요...ㅋㅋㅋㅋㅋ (레벨 1이 미션으로 끝나서 그런 것 일지도요...ㅎ)

-------------------
DM 내용

미스터코(고은석) [8:34 AM]
화투님 안녕하세요~!
체스피드백을 받고 있는 미스터코입니다

다름아니라 피드백 주신 것에 대해 여쭤보고 싶어서 DM드립니다

> ChessRoundService에 대해서는 현재 구현 하실 때 혼자서 테스트 할경우에는 하나의 요청만 들어오기에는 큰 문제가 없습니다만
여러 사용자의 요청에도 동일한 ChessRound를 사용하기 때문에, 동기화 이슈가 발생할 수 있습니다.
(자바 기반의 백엔드에서 모든 리퀘스트는 쓰레드 기반으로 작동하는데요, 현재 구현상 JVM내에 모든 쓰레드가 싱글톤 객체가 들고있는 필드인 ChessRound을 공유하게 됩니다.)

따라서 ChessRound을 다른 사용자와 상태를 공유하면, 또 다른 사용자가 변경한 요청에 따라 다른 사용자도 영향을 받을 수 있다는 건데요.
ChessRound를 ChessRoundService에서 필드로 관리하는것이 아닌 ChessRound를 메서드 스코프 내에서 생성하고 다루는 것이 좋지 않을까 해서 피드백 드렸습니다.

자바의 스프링 프레임워크 같은 경우에서도 상태가 있는 객체는 몇몇 케이스를 제외하고는 다들 메서드 혹은 한 리퀘스트 스코프로 관리합니다. :slightly_smiling_face:

---

말씀해주신 부분 생각을 해보고 있습니다! (그런데 수료까지 남은 시간이 많지 않아서… 일단 생각나는 대로 여쭤볼께요)

제가 Service라는 개념을 완전히 이해하진 못했는데
말씀해주신 것을 토대로 생각하면 Service 는 상태를 가지지 않기 때문에 싱글톤으로 남겨놔도 좋을 것 같습니다.

그런데 그렇게 Service를 사용하면 ChessRound 의 상태를(현재 White, BlackPlayer 의 상태 + 현재 White차례인지) 어딘가에서는 저장하고 있어야 겠지요.

특정 함수 내에서 ChessRound 를 생성하려면 [현재 White, BlackPlayer 의 상태 + 현재 White차례인지] 가 필요한 것인데…
지금은 각 DAO 에 요청을 해서
함수 내에서 현재 사용할 ChessRound 를 생성해볼 수도 있을 것같네요

이 경우 DB (DAO가 무조건 DB에서 가져온다면?) 에 매번 접근하게 되는 것 같은데…
일단 DB를 떠나서(성능? 등을 위해서 메모리에 캐시되어있을 수도 있을 듯 하구요) 필요한 정보를 어딘가에서 (공유 자원처럼?) 가져오는 형태가 되는 것 같은데

요약해보면..

‘자바의 스프링 프레임워크 같은 경우에서도 상태가 있는 객체는 몇몇 케이스를 제외하고는 다들 메서드 혹은 한 리퀘스트 스코프로 관리합니다.’
말씀해주신 부분을 해결하기 위해서 일단… 저는 DB처럼 모든 메서드에서 공유? 접근? 할 수 있는 곳에 상태를 저장하고 읽어오는 방식이 생각나는 것 같습니다.

다른 식의 접근 방식이 있을지요?
감이 잘 안옵니다 ㅠㅎ

화투(박현식) [10:26 AM]
안녕하세요! 말씀하신대로 데이터베이스에 접근해서 가져오는 형태가 있을수도 있습니다.
혹은 네트워크비용이 아깝다면 휘발성이지만 하나의 세션에 대해서만 유지하고싶으실 셩우 세션을 통해서 상태를 관리할수도 있겠네요. :) (edited)
여러 하나의 인스턴스에 여러 쓰레드가 요청을 하였을때 다른 쓰레드와 동기화 이슈가 없을 방안은 모두 가능하시다고 보면 됩니다. :)

미스터코(고은석) [11:16 AM]
알겠습니다!

세션 등… 한 번 알아보고 싶네요 ..!
일단… 데이터베이스로 접근하는 방식으로 구현은 해보겠습니다!

미스터코(고은석) [12:50 PM]
일단 데이터베이스에서 매번 상태를 가져오는 방식으로 서비스와 상태를 분리했습니다 (이 경우 매번 가져오고 저장하는 비용이 너무 큰 것 같네요..)

구현하면서 궁금한 부분은… 이런 경우 상태는 어디에 저장되는지였습니다 (각각의 메소드 혹은 리퀘스트가 자신만의 스코프로 관리될 경우… 내가 필요한 상태를 가져와야하는데 말이죠)

즉.. 체스라면… 하나의 ChessRound를 가정해보겠습니다. (ChessRound 는 두명의 Player가 게임을 진행하기 위해 필요한 …상태를 가지고 있습니다.)
그러면 웹 브라우저를 통해서 말을 옮긴다면…
서버에서는 해당 말에 맞는 ChessRound의 상태를 변경해 주겠지요??

이 경우 … ChessRoundService.move() 내부에서 해당하는 ChessRound 의 상태[말을 이동하는]를 변경해 줄텐데….

어찌 되었건 … 해당 연결(해당 클라이언트와 서버) 에 연관된 ChessRound 에 접근이 가능해야 할 태지요
세션을 잘 모르지만 해당 연결에 관련된 정보를 저장 할 수 있다면
해당 ChessRound 를 거기에 저장해놓으면 좋을 듯 하고요
결론적으로…

특정 연결(게임을 진행하는 브라우저와 서버) 에서 사용하는 상태(ChessRound) 를 저장한 무언가가 필요하다는 건데..

일단은 저는 데이터베이스에서 들고 오는 것이구요

세션에서도 가능할 텐데…(ChessRound 라는 데이터가 매우 크다면 이 또한 부담이 될 듯 하네요)
그렇다면.. 해당 연결을 나타내는 id 같은 걸 세션에 저장하고
데이터베이스처럼 상태들을 저장한 무언가에서 매번 꺼내오는 방식이 될지요???

화투(박현식) [2:14 PM]
데이터베이스 통신에 대한 비용이 생각보다 그리 크지 않습니다. :slightly_smiling_face:
현재는 콘솔에 맞춰서 모델링이 되었디만 추후 게임의 상태에 대해서 조금 더 웹에 맞게 모델링을 한다면 조금 더 구조 개선이 되어 이러한 부분들도 쉽개 해결 될 수도 있을것 같네요. :slightly_smiling_face:
정말 단순하게 현재 체스게임에 대한 메타정보, 플레이어 정보, 각 말에 대한 데이터 (32개)라고 해봐야 실제 운영되는 서비스에 비해 극히 적은 부분이고요,
만약 부담이 되는 서비스라면 다른 방법을 찾게 되겠죠? (edited)

미스터코(고은석) [8:28 PM]
아직 해보지 않은 것들에 대한 두려움이 컸네요 ㅠㅎ (그래서 그냥.. 비용이 크겠다 하는 것을 확인도 안해보고 피했던 것 같아요)

바쁜 와중에도 귀한 피드백 감사합니다..!!

ps. 앗 혹시… 좀 더 추상화 했으면 하는 부분을 조금 짚어 주실 수 있을까요?? 이번에 웹 관련 미션을 하면서 조금 정리가 필요한 것 같은데.. 짚어 주시는 부분도 함께 고민해보려고 합니다..!

화투(박현식) [8:31 PM]
큰 내용은 아니고 현재 메서드 내에 private 메서드가 상당히 많은데요,
서비스가 다른 서비스를 의존하는 방향으로하여 책임을 쪼개는 방식에 대해서 말씀드렸습니다. :slightly_smiling_face:
하나의 서비스에서 다 하기보다는 조금씩 나눠나갈수도 있었을 것 같아서요 :slightly_smiling_face:
Message Input

Message 화투(박현식)